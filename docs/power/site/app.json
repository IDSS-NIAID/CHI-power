[{"name":"app.R","content":"# simple power exploration app\n\nlibrary(shiny)\nlibrary(bslib)\n\nui <- page_sidebar(\n  title = 'Power analysis',\n  sidebar = sidebar(\n    # parameters for the illustration\n    title = 'Parameters',\n    sliderInput('typeI_error',                     'Significance level',        0.05 , min = 0.001, max = 0.1), # significance level\n    sliderInput(          'p', 'Cell death rates (unexposed / exposed)', c(0.2, 0.4 ), min = 0    , max = 1  ), # effect size\n    sliderInput('variability',                            'Variability',        0.1  , min = 0    , max = 1  ), # variability\n    numericInput(         'n',                            'Sample size',        5    , min = 2               ) # sample size\n  ),\n\n  card(\n    plotOutput('cell_death_rates')#,\n    #plotOutput('power')\n  )\n)\n\nserver <- function(input, output)\n{\n  calc_ab <- function(mean, variability = NULL, v = NULL)\n  {\n    if(is.null(v))\n      v <- mean * (1 - mean) * variability\n\n    # function to optimize\n    fn <- function(x) # x = c(alpha, beta)\n    {\n      crossprod(c(mu_beta(x[1], x[2]), sigma2_beta(x[1], x[2])) - c(mean, v))\n    }\n\n    retval <- optim(c(1, 1), fn)$par\n    names(retval) <- c('alpha', 'beta')\n\n    return(retval)\n  }\n\n  mu_beta <- function(alpha, beta)\n  {\n    retval <- alpha / (alpha + beta)\n    names(retval) <- 'mean'\n\n    return(retval)\n  }\n\n  sigma2_beta <- function(alpha, beta)\n  {\n    retval <- alpha * beta / ((alpha + beta)^2 * (alpha + beta + 1))\n    names(retval) <- 'variance'\n\n    return(retval)\n  }\n\n  # distribution of cell death rates\n  params_u <- reactive({calc_ab(input$p[1], variability = input$variability)})\n  params_e <- reactive({calc_ab(input$p[2], variability = input$variability)})\n\n  output$cell_death_rates <- renderPlot(\n    {\n      curves <- data.frame(x = seq(0.01, 0.99, length.out = 200))\n      curves$cntl <- dbeta(curves$x, params_u()[1], params_u()[2])\n      curves$case <- dbeta(curves$x, params_e()[1], params_e()[2])\n\n      plot(curves$x, curves$cntl, type = 'l', col = '#377EB8', lwd = 2, bty = 'l',\n           xlab = 'Cell death rate', ylab = 'Density', main = 'Distribution of cell death rates (truth / hidden)')\n\n      lines(curves$x, curves$case, col = '#E41A1C', lwd = 2)\n    })\n\n  # distribution of cell death rate statistics\n  #output$power <- renderPlot({plot_beta_stats(input$p[1], params_u(), input$p[2], params_e(), input$n, input$typeI_error)})\n}\n\nshinyApp(ui = ui, server = server)\n","type":"text"}]
